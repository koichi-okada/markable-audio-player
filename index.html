<!DOCTYPE html>

<html lang="en">

<head>

<meta charset="UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Markable Audio Player</title>

<style> /* ===== Global Styles ===== */

{ box-sizing: border-box; }

body { font-family: Helvetica, Arial, sans-serif; margin: 0; padding: 48px 64px; background: #001f33; color: #a0d8ff; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }

h1 { font-weight: 700; font-size: 2.5rem; margin: 0 0 32px 0; letter-spacing: 2px; text-transform: uppercase; color: #a0d8ff; text-shadow: none; }

.container { width: 100%; max-width: 800px; background: rgba(0, 31, 51, 0.9); border-radius: 20px; padding: 48px; box-shadow: none; display: flex; flex-direction: column; gap: 32px; }

.section { display: flex; flex-direction: column; }

label { font-size: 1.1rem; font-weight: 600; margin-bottom: 12px; color: #a0d8ff; }

#fileInfo { font-size: 0.9rem; color: #7fbfff; margin-top: -16px; margin-bottom: 24px; font-style: italic; }

audio#audioPlayer { width: 100%; height: 50px; border-radius: 20px; outline: none; box-shadow: none; background: #00334d; }

#controls { display: flex; justify-content: center; gap: 48px; }

button { background: transparent; border: none; cursor: pointer; color: #66ccff; display: flex; flex-direction: column; align-items: center; gap: 4px; font-weight: 600; user-select: none; padding: 0; min-width: 60px; transition: color 0.3s ease; }

button:disabled { color: #335577; cursor: not-allowed; }

button .icon { font-size: 2.8rem; line-height: 1; user-select: none; color: #66ccff; }

button .label { font-size: 0.75rem; color: #66ccff; user-select: none; text-transform: lowercase; letter-spacing: 0.05em; }

#marksList { font-size: 1.1rem; margin-top: 12px; display: flex; flex-wrap: wrap; gap: 16px; color: #a0d8ff; }

.mark-item { background: transparent; border: 1.5px solid #66ccff; padding: 10px 18px; border-radius: 24px; cursor: pointer; color: #66ccff; font-weight: 700; transition: background 0.3s ease, color 0.3s ease; user-select: none; min-width: 60px; text-align: center; }

.mark-item:hover { background: #66ccff; color: #001f33; }

#log { font-size: 0.9rem; background: rgba(0, 31, 51, 0.75); padding: 20px; border-radius: 16px; max-height: 260px; overflow-y: auto; white-space: pre-wrap; word-break: break-word; box-shadow: inset 0 0 0 #3399ff; color: #a0d8ff; line-height: 1.4; font-family: 'Courier New', monospace; margin-bottom: 12px; }

#log::-webkit-scrollbar { width: 10px; }

#log::-webkit-scrollbar-track { background: transparent; }

#log::-webkit-scrollbar-thumb { background: #66ccff; border-radius: 5px; }

#log::-webkit-scrollbar-thumb:hover { background: #99ccff; }

#exportImport { margin-top: 0; text-align: center; font-size: 0.9rem; color: #66ccff; user-select: none; letter-spacing: 0.1em; cursor: default; }

#exportImport a { color: #66ccff; text-decoration: none; margin: 0 12px; cursor: pointer; transition: color 0.3s ease; }

#exportImport a:hover { color: #99ccff; text-decoration: underline; }

@media (max-width: 768px) { body { padding: 24px 16px; } h1 { font-size: 1.8rem; margin-bottom: 24px; } .container { padding: 24px; gap: 24px; } button .icon { font-size: 2.2rem; } button .label { font-size: 0.65rem; } }

/* Controls: three icons in a row with label below each */ #controls { gap: 64px; }

#controls button { min-width: 70px; color: #66ccff; }

#controls button .icon { font-size: 3rem; color: #66ccff; line-height: 1; }

#controls button .label { font-size: 0.75rem; color: #66ccff; text-transform: lowercase; letter-spacing: 0.05em; margin-top: 4px; }

</style>

</head>

<body>

<h1>MARKABLE AUDIO PLAYER</h1>

<div class="container">

<div class="section"> <label for="audioFile">Select Audio File:</label> <input type="file" id="audioFile" accept="audio/*"> <div id="fileInfo" class="file-info"></div> </div>

<div class="section"> <audio id="audioPlayer" controls preload="metadata"></audio> </div>

<div class="section" id="controls"> <button id="markBtn" disabled title="Add mark at current position"> <span class="icon">⚪︎</span> <span class="label">mark</span> </button> <button id="deleteMarkBtn" disabled title="Delete mark at current position"> <span class="icon">×</span> <span class="label">delete</span> </button> <button id="prevMarkBtn" disabled title="Jump to previous mark or start"> <span class="icon"><</span> <span class="label">previous</span> </button> </div>

<div class="section"> <strong>Marks:</strong> <div id="marksList">(none)</div> </div>

<div class="section"> <strong>Log:</strong> <div id="log"></div> <div id="exportImport"> <a href="#" id="exportBtn" disabled>export</a>│<a href="#" id="importBtn" disabled>import</a> </div> </div>

</div>

<script> // IndexedDB and app logic remain unchanged // Only IDs and button elements updated to match new UI

const DB_NAME = 'audioMarks'; const DB_VERSION = 1; const STORE_NAME = 'marks';

let db = null; let currentFile = null; let currentFileKey = null; let currentMarks = [];

const audioFileInput = document.getElementById('audioFile'); const audioPlayer = document.getElementById('audioPlayer'); const markBtn = document.getElementById('markBtn'); const prevMarkBtn = document.getElementById('prevMarkBtn'); const deleteMarkBtn = document.getElementById('deleteMarkBtn'); const exportBtn = document.getElementById('exportBtn'); const importBtn = document.getElementById('importBtn');

const marksListEl = document.getElementById('marksList'); const logEl = document.getElementById('log'); const fileInfoEl = document.getElementById('fileInfo');

function log(message) { const time = new Date().toLocaleTimeString(); logEl.textContent += [${time}] ${message} ; logEl.scrollTop = logEl.scrollHeight; }

function formatTime(sec) { const s = Math.floor(sec % 60); const m = Math.floor(sec / 60); return ${m}:${s.toString().padStart(2, '0')}; }

function enableControls(enabled) { markBtn.disabled = !enabled; prevMarkBtn.disabled = !enabled; deleteMarkBtn.disabled = !enabled; exportBtn.disabled = !enabled; importBtn.disabled = !enabled; }

function openDB() { return new Promise((resolve, reject) => { const request = indexedDB.open(DB_NAME, DB_VERSION); request.onupgradeneeded = (event) => { const db = event.target.result; if (!db.objectStoreNames.contains(STORE_NAME)) { db.createObjectStore(STORE_NAME, { keyPath: 'fileKey' }); log('IndexedDB: Object store created.'); } }; request.onsuccess = (event) => { db = event.target.result; log('✓ Connected to IndexedDB.'); resolve(db); }; request.onerror = (event) => { log('✗ Failed to initialize IndexedDB.'); reject(event.target.error); }; }); }

function getFileKey(file) { if (!file) return null; const name = file.name || 'unknown'; const size = file.size || 0; const lastModified = file.lastModified ? new Date(file.lastModified).toISOString() : 'unknown'; return ${name}|${size}|${lastModified}; }

function loadMarks(fileKey) { return new Promise((resolve, reject) => { if (!db) { resolve({ fileKey, marks: [] }); return; } const tx = db.transaction(STORE_NAME, 'readonly'); const store = tx.objectStore(STORE_NAME); const request = store.get(fileKey); request.onsuccess = () => { if (request.result) { resolve(request.result); } else { resolve({ fileKey, marks: [] }); } }; request.onerror = () => { reject(request.error); }; }); }

function saveMarks(fileKey, marks) { return new Promise((resolve, reject) => { if (!db) { reject(new Error('DB not initialized')); return; } const tx = db.transaction(STORE_NAME, 'readwrite'); const store = tx.objectStore(STORE_NAME); const data = { fileKey, marks }; const request = store.put(data); request.onsuccess = () => resolve(); request.onerror = () => reject(request.error); }); }

function updateMarksUI() { marksListEl.innerHTML = ''; if (!currentMarks || currentMarks.length === 0) { marksListEl.textContent = '(none)'; return; } currentMarks.slice().sort((a, b) => a - b).forEach((t) => { const span = document.createElement('span'); span.className = 'mark-item'; span.textContent = formatTime(t); span.title = Jump to mark at ${t.toFixed(3)} seconds; span.addEventListener('click', () => { audioPlayer.currentTime = t; log(Jumped to mark: ${formatTime(t)}); }); marksListEl.appendChild(span); }); }

function updateFileInfo() { if (!currentFile) { fileInfoEl.textContent = ''; return; } const size = (currentFile.size / 1024 / 1024).toFixed(2); fileInfoEl.textContent = ${currentFile.name} (${size} MB); }

// Event handlers

audioFileInput.addEventListener('change', async (e) => { const file = e.target.files?.[0]; if (!file) { enableControls(false); return; } try { currentFile = file; currentFileKey = getFileKey(file); updateFileInfo(); const url = URL.createObjectURL(file); audioPlayer.src = url; enableControls(true); log(File selected: ${file.name}); const data = await loadMarks(currentFileKey); currentMarks = data.marks || []; updateMarksUI(); log(Loaded ${currentMarks.length} marks.); } catch (error) { log(Error: ${error.message}); enableControls(false); } });

markBtn.addEventListener('click', async () => { const currentTime = audioPlayer.currentTime; if (currentMarks.includes(currentTime)) { log('Warning: Mark already exists at this position.'); return; } currentMarks.push(currentTime); await saveMarks(currentFileKey, currentMarks); updateMarksUI(); log(Mark added at ${formatTime(currentTime)}); });

prevMarkBtn.addEventListener('click', () => { const currentTime = audioPlayer.currentTime; const prev = currentMarks.filter(m => m < currentTime).sort((a, b) => b - a)[0]; if (prev !== undefined) { audioPlayer.currentTime = prev; log(Jumped to previous mark: ${formatTime(prev)}); } else { audioPlayer.currentTime = 0; log('Jumped to start.'); } });

deleteMarkBtn.addEventListener('click', async () => { const currentTime = audioPlayer.currentTime; const index = currentMarks.indexOf(currentTime); if (index === -1) { log('Warning: No mark at current position to delete.'); return; } currentMarks.splice(index, 1); await saveMarks(currentFileKey, currentMarks); updateMarksUI(); log(Mark deleted at ${formatTime(currentTime)}); });

exportBtn.addEventListener('click', () => { const data = { fileName: currentFile.name, fileSize: currentFile.size, marks: currentMarks, exportDate: new Date().toISOString(), }; const json = JSON.stringify(data, null, 2); const blob = new Blob([json], { type: 'application/json' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = marks_${Date.now()}.json; a.click(); URL.revokeObjectURL(url); log(Exported marks: ${a.download}); });

importBtn.addEventListener('click', () => { document.getElementById('importFileInput').click(); });

document.getElementById('importFileInput').addEventListener('change', async (e) => { const file = e.target.files?.[0]; if (!file) return; try { const text = await file.text(); const data = JSON.parse(text); if (!Array.isArray(data.marks)) throw new Error('Invalid mark file format.'); currentMarks = data.marks; await saveMarks(currentFileKey, currentMarks); updateMarksUI(); log(Imported ${currentMarks.length} marks.); } catch (e) { log(Import error: ${e.message}); } e.target.value = ''; });

if ('serviceWorker' in navigator) { window.addEventListener('load', () => { navigator.serviceWorker.register('service-worker.js') .then(() => log('Service Worker registered.')) .catch(error => log(Service Worker registration failed: ${error.message})); }); }

openDB() .then(() => log('IndexedDB initialized.')) .catch(() => log('IndexedDB not available. Marks will not be saved.')); </script>

<input type="file" id="importFileInput" accept="application/json" style="display:none;">

</body>

</html> });

</script>



</body>

</html>

